<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S√©rgio & Isabella</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚ù§Ô∏è</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Sacramento&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #e91e63;
            --bg-gradient: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            --text-color: #333;
            --card-bg: rgba(255, 255, 255, 0.95);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Montserrat', sans-serif;
            background: var(--bg-gradient);
            color: var(--text-color);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Hero Section (Capa) */
        header {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            /* Fundo padr√£o (caso n√£o tenha foto carregada ainda) */
            background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://images.unsplash.com/photo-1516589178581-6cd7833ae3b2?q=80&w=1920&auto=format&fit=crop'); 
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: white;
            padding: 20px;
            transition: background-image 1s ease-in-out; /* Transi√ß√£o suave ao trocar */
        }

        h1 {
            font-family: 'Sacramento', cursive;
            font-size: 4.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8); /* Sombra mais forte para garantir leitura */
            animation: fadeIn 2s ease-in;
        }

        .subtitle { font-size: 1.4rem; font-weight: 300; text-shadow: 1px 1px 3px rgba(0,0,0,0.8); }

        /* Contador */
        .counter-section { padding: 60px 20px; text-align: center; }
        .timer { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin-top: 30px; }
        .time-box {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: var(--primary-color);
            padding: 20px;
            border-radius: 15px;
            min-width: 90px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            transition: transform 0.3s;
        }
        .time-box:hover { transform: translateY(-5px); }
        .time-box span { display: block; font-size: 2rem; font-weight: bold; color: #333; }
        .time-box label { font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; }

        /* Galeria */
        .gallery-section { padding: 60px 0; text-align: center; overflow: hidden; }
        .section-title { color: var(--primary-color); font-size: 2.5rem; margin-bottom: 40px; font-family: 'Sacramento', cursive; }
        .carousel-container { width: 100%; overflow: hidden; position: relative; margin-bottom: 30px; }
        .carousel-track { display: flex;width: max-content;
            /* Otimiza√ß√£o para iPhone */
            will-change: transform;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            transform: translate3d(0, 0, 0); 
            /* Anima√ß√£o */
            animation: scroll 40s linear infinite;
        }
        .carousel-slide { width: 300px; height: 450px; padding: 10px; flex-shrink: 0; }
        .carousel-slide img { width: 100%; height: 100%; object-fit: cover; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            -webkit-user-drag: none; /* Evita arrastar a imagem no touch */
            pointer-events: none;    /* Melhora a performance do scroll */
        }

        /* √ÅREA DE UPLOADS (Bot√µes) */
        .upload-section {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
            padding: 20px;
        }

        .btn-padrao {
            color: white; padding: 12px 25px; border-radius: 50px; cursor: pointer;
            font-size: 0.9rem; font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: transform 0.2s; display: inline-flex; align-items: center; gap: 8px;
        }
        .btn-padrao:hover { transform: scale(1.05); }

        .btn-foto { background-color: var(--primary-color); }
        .btn-capa { background-color: #2196F3; } /* Azul para diferenciar */

        input[type="file"] { display: none; }
        #upload-status { text-align: center; margin-top: 10px; font-size: 0.9rem; color: #666; font-weight: bold; width: 100%; }

        /* Mensagens (Scroll Snap) */
        .message-section { padding: 60px 0 120px 0; text-align: center; }
        .messages-container {
            display: flex; overflow-x: auto; scroll-snap-type: x mandatory; gap: 20px;
            padding: 20px 20px 40px 20px; -webkit-overflow-scrolling: touch;
        }
        .messages-container::-webkit-scrollbar { height: 8px; }
        .messages-container::-webkit-scrollbar-thumb { background: #ccc; border-radius: 10px; }
        
        .msg-card {
            background: var(--card-bg); min-width: 300px; max-width: 300px; padding: 30px;
            border-radius: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); scroll-snap-align: center;
            display: flex; flex-direction: column; position: relative; border: 1px solid rgba(233, 30, 99, 0.1);
        }
        .msg-card::before {
            content: '‚ù§'; position: absolute; top: -15px; left: 50%; transform: translateX(-50%);
            font-size: 2rem; color: var(--primary-color); background: var(--bg-gradient); border-radius: 50%; padding: 0 10px;
        }
        .msg-text { font-size: 1rem; color: #555; margin-bottom: 15px; white-space: pre-wrap; }
        .msg-date { font-size: 0.75rem; color: #999; margin-top: auto; font-style: italic; }

        .new-msg-area { max-width: 500px; margin: 30px auto 0 auto; padding: 0 20px; display: flex; flex-direction: column; gap: 10px; }
        .new-msg-input { width: 100%; padding: 15px; border-radius: 15px; border: 2px solid #ddd; font-family: 'Montserrat', sans-serif; resize: vertical; min-height: 80px; }
        .new-msg-btn { background: var(--primary-color); color: white; border: none; padding: 12px; border-radius: 50px; cursor: pointer; font-weight: bold; }

        /* Spotify */
        .spotify-container { position: fixed; bottom: 20px; right: 20px; z-index: 1000; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); background: #000; overflow: hidden; width: 300px; height: 80px; transition: height 0.3s ease; }
        .spotify-container:hover { height: 380px; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes scroll { 0% { transform: translateX(0); -webkit-transform: translateX(0);} 100% { transform: translateX(-50%); -webkit-transform: translateX(-50%);} }
        @media (max-width: 768px) { h1 { font-size: 3rem; } .carousel-slide { width: 250px; height: 350px; } }
    </style>
</head>
<body>

    <header id="main-header">
        <h1>S√©rgio & Isabella</h1>
        <p class="subtitle">Tudo at√© aqui</p>
    </header>

    <section class="counter-section">
        <h2 class="section-title">Nossa Hist√≥ria em N√∫meros</h2>
        <div class="timer" id="timer"></div>
    </section>

    <section class="gallery-section">
        <h2 class="section-title">Nossos Momentos</h2>
        <div class="carousel-container">
            <div class="carousel-track" id="carousel-track"></div>
        </div>
        
        <div class="upload-section">
            <label for="photo-input" class="btn-padrao btn-foto">
                üì∑ Add Foto no √Ålbum
            </label>
            <input type="file" id="photo-input" accept="image/*" onchange="uploadPhoto('galeria')">

            <label for="cover-input" class="btn-padrao btn-capa">
                üñºÔ∏è Alterar Capa
            </label>
            <input type="file" id="cover-input" accept="image/*" onchange="uploadPhoto('capa')">

            <p id="upload-status"></p>
        </div>
    </section>

    <section class="message-section">
        <h2 class="section-title">Nossos Recadinhos</h2>
        <div class="messages-container" id="messages-list">
            <div class="msg-card">
                <h3 style="font-family: 'Sacramento', cursive; font-size: 2rem; color: var(--primary-color); margin-bottom: 10px;">Pra vida toda</h3>
                <p class="msg-text">As vezes n√£o sabemos o que falar, as vezes vamos trope√ßar e cair feio, mas sempre vamos ter um ao outro pra se segurar. Ainda temos muito o que crescer, mas vamos sempre fazer isso juntos. Rumo ao infinito e al√©m.</p>
                <p class="msg-date">De: S√©rgio</p>
            </div>
        </div>
        <div class="new-msg-area">
            <textarea id="msg-input" class="new-msg-input" placeholder="Escreva um recadinho..."></textarea>
            <button class="new-msg-btn" onclick="postMessage()">üíå Publicar Recado</button>
        </div>
    </section>

    <div class="spotify-container">
        <iframe style="border-radius:12px" 
            src="https://open.spotify.com/embed/playlist/4vULI9tge0O3erhK8mGjNK?utm_source=generator" 
            width="100%" height="100%" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy">
        </iframe>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, setDoc, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js";

        // -------------------------------------------------------------
        // ‚ö†Ô∏è SUAS CHAVES DO FIREBASE AQUI ‚ö†Ô∏è
        // -------------------------------------------------------------
         // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBEF9-Mi-V-TKa-ITUoZLDXsHGtYmZeIcY",
            authDomain: "presente-sergio-isabella.firebaseapp.com",
            projectId: "presente-sergio-isabella",
            storageBucket: "presente-sergio-isabella.firebasestorage.app",
            messagingSenderId: "169034950596",
            appId: "1:169034950596:web:55ba95095d04dd70c1e691"
        };


        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // --- Timer ---
        const startDate = new Date(2024, 7, 6); 
        function updateTimer() {
            const now = new Date();
            const diff = now - startDate;
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
            const minutes = Math.floor((diff / (1000 * 60)) % 60);
            const seconds = Math.floor((diff / 1000) % 60);
            document.getElementById('timer').innerHTML = `
                <div class="time-box"><span>${days}</span><label>Dias</label></div>
                <div class="time-box"><span>${hours}</span><label>Horas</label></div>
                <div class="time-box"><span>${minutes}</span><label>Min</label></div>
                <div class="time-box"><span>${seconds}</span><label>Seg</label></div>
            `;
        }
        setInterval(updateTimer, 1000);
        updateTimer();

        // --- 1. Carregar Fotos do √Ålbum ---
        async function loadPhotos() {
            const track = document.getElementById('carousel-track');
            track.innerHTML = ''; 
            
            const q = query(collection(db, "fotos"), orderBy("dataUpload", "desc"));
            const querySnapshot = await getDocs(q);
            let photoUrls = [];
            querySnapshot.forEach((doc) => { photoUrls.push(doc.data().url); });

            if (photoUrls.length === 0) { photoUrls = ['https://via.placeholder.com/300x450?text=Sua+Foto+Aqui']; }
            const displayPhotos = [...photoUrls, ...photoUrls, ...photoUrls]; 

            displayPhotos.forEach(url => {
                const div = document.createElement('div');
                div.className = 'carousel-slide';
                div.innerHTML = `<img src="${url}" alt="Momento">`;
                track.appendChild(div);
            });
        }
        loadPhotos();

        // --- 2. NOVO: Carregar e Atualizar CAPA (Background) ---
        async function loadCover() {
            try {
                const docRef = doc(db, "config", "capa_site");
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const url = docSnap.data().url;
                    // Atualiza o background do Header
                    document.getElementById('main-header').style.backgroundImage = `linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url('${url}')`;
                }
            } catch (e) {
                console.log("Ainda sem capa personalizada.");
            }
        }
        loadCover(); // Chama ao abrir o site

        // --- 3. Fun√ß√£o Unificada de Upload (Galeria ou Capa) ---
        window.uploadPhoto = async function(tipo) {
            const inputId = tipo === 'capa' ? 'cover-input' : 'photo-input';
            const fileInput = document.getElementById(inputId);
            const file = fileInput.files[0];
            const status = document.getElementById('upload-status');

            if (!file) return;

            status.innerText = tipo === 'capa' ? "Atualizando a capa... üñºÔ∏è" : "Enviando para o √°lbum... üì∑";
            status.style.color = "#e91e63";
            
            try {
                // Upload para o Storage
                const storageRef = ref(storage, `uploads/${file.name}-${Date.now()}`);
                await uploadBytes(storageRef, file);
                const downloadURL = await getDownloadURL(storageRef);

                if (tipo === 'capa') {
                    // Se for CAPA, substitui o documento de configura√ß√£o
                    await setDoc(doc(db, "config", "capa_site"), {
                        url: downloadURL,
                        atualizadoEm: new Date()
                    });
                    loadCover(); // Atualiza a tela na hora
                    status.innerText = "Capa nova definida! ‚ú®";
                } else {
                    // Se for GALERIA, adiciona na lista
                    await addDoc(collection(db, "fotos"), {
                        url: downloadURL,
                        dataUpload: new Date()
                    });
                    loadPhotos(); // Atualiza o carrossel
                    status.innerText = "Foto adicionada ao √°lbum! ‚ú®";
                }
                
                setTimeout(() => { status.innerText = ""; }, 3000);
            } catch (error) {
                console.error("Erro:", error);
                status.innerText = "Erro ao enviar. Tente de novo.";
            }
        }

        // --- 4. Mensagens ---
        window.postMessage = async function() {
            const input = document.getElementById('msg-input');
            const text = input.value.trim();
            if (!text) { alert("Escreva algo! üòä"); return; }

            try {
                await addDoc(collection(db, "mensagens"), { texto: text, data: new Date() });
                input.value = ''; loadMessages(); alert("Recado enviado! ‚ù§Ô∏è");
            } catch (error) { console.error("Erro:", error); }
        }

        async function loadMessages() {
            const container = document.getElementById('messages-list');
            while (container.children.length > 1) { container.removeChild(container.lastChild); }
            const q = query(collection(db, "mensagens"), orderBy("data", "desc"));
            const querySnapshot = await getDocs(q);
            querySnapshot.forEach((doc) => {
                const data = doc.data();
                const dateStr = data.data.toDate().toLocaleDateString('pt-BR');
                const card = document.createElement('div');
                card.className = 'msg-card';
                card.innerHTML = `<p class="msg-text">"${data.texto}"</p><p class="msg-date">Em ${dateStr}</p>`;
                container.appendChild(card);
            });
        }
        loadMessages();
    </script>
</body>
</html>
